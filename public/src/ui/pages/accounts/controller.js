import{b as O} from"../../../../node_modules/sage-ui/js/page/controller-loader.js";import{d as j,e as D} from"../../../../chunk-c3d74745e3176616.js";import{f as K,g as w,h as C,i as W,p as U,q as L,s as h,t as _} from"../../../../chunk-a24c0c94b52b5aa0.js";import"../../../../chunk-0f36676b13b949b7.js";function Z(q){if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent))if(q instanceof Promise)return navigator.clipboard.write([new ClipboardItem({"text/plain":q.then((x)=>new Blob([x],{type:"text/plain"}))})]);else return navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([q],{type:"text/plain"})})]);else if(q instanceof Promise)return q.then((x)=>navigator.clipboard.writeText(x));else return navigator.clipboard.writeText(q)}function I(q,x){let F=null;return function(...M){clearTimeout(F),F=setTimeout(()=>q(...M),x)}}function Q(q){for(let x in q)if(Object.hasOwn(q,x)){if(typeof q[x]==="object"&&q[x]!==null)if(Array.isArray(q[x])||q[x]instanceof $)for(let F=0;F<q[x].length;F++)if(typeof q[x][F]==="object"&&q[x][F]!==null)Q(q[x][F]);else q[x][F]=void 0;else Q(q[x]);q[x]=void 0}}var $=Object.getPrototypeOf(Uint8Array);function A(q){let x;const F=K("accounts-data-list"),M=K("account");window.onpageshow=(z)=>{if(q===void 0)return W("/");if(!z.persisted)window.onfocus=I(E,200),K("logout").onclick=P,K("show-pwd").onclick=N,K("copy-pwd").onclick=H,K("account").onkeydown=H,K("add-account").onclick=R,K("open-settings").onclick=b;L(q).then((G)=>{x=G}).catch(()=>{x=U(q),V("New user created!",2000)}).finally(()=>{x.accounts=j(x.accounts,[f]),f()})};function V(z,G){C(z,G,"zoom-200 no-zoom-m")}function f(){F.replaceChildren(),x.accounts.toSorted().forEach((z)=>F.append(w(`<option value='${z.name}'>`)))}function E(){Z("").then(()=>V("Cleared!",2000))}function P(){Q(q),Q(x),q=void 0,O(),W("/")}function N(){const z=K("show-pwd"),G=K("pwd-tooltip");if(z.checked)X().then((J)=>_(x,J)).then((J)=>{G.innerText=J});else G.innerText=""}function H(z){if(z.key!=="Enter"&&z.type!=="click")return;z.preventDefault(),Z(X().then((G)=>z.ctrlKey?x.accounts.find((J)=>J.name===G).settings.userName:_(x,G))).then(()=>{M.value="",V("Copied!",2000)})}function R(){const z=M.value;h(x,z),V("Created!",2000)}function b(){X().then((z)=>{W("/accounts/"+z+"/settings",D.from(x))})}function X(){return new Promise((z,G)=>{const J=M.value;if(J==="")return G(new Error("No account selected."));const S=Array.from(F.options).map((Y)=>Y.value).sort(),B=S.filter((Y)=>Y.toLowerCase().includes(J.toLowerCase()));if(!S.includes(J))if(B.length>0)return M.value=B.at(0),G(new Error("Found relevant account, but not an exact match."));else return R(),z(J);return z(J)})}}export{A as default};
